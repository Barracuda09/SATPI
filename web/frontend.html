<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="stylesheet.css">
<title>SAT>IP - Frontend info Page</title>

<script src="loadxmldoc.js"></script>
<script src="postxmldoc.js"></script>
<script>
    function addTableLineEntry(data, name, valname) {
		entry =  "<tr><td>" + name + "</td>";
		for (en = 0; en < data.length; en++) {
			entry +=  "<td>";
			value  = data[en].getElementsByTagName(valname)[0].childNodes[0].nodeValue;
			if (value == "submit") {
				nr     = data[en].getElementsByTagName("value")[0].childNodes[0].nodeValue;
				entry += "<form>";
				entry += "<input type=\"" + value + "\" name=\"" + valname + "\" value=\"" + nr + "\"";
				entry += "id=\"" + value + nr + "\"";
				entry += "onclick=\"postData(id, document.getElementById(id).value)\"/>"
				entry += "</form>";
			} else {
				entry += value;
			}
			entry +=  "</td>";
		}
		page +=  "</tr>";
		return entry;
	}
	
    function buildcontent(xmlDoc) {
		page = "";
		
		appdata = xmlDoc.getElementsByTagName("appdata");
		page +=  "<table border='5' style=\"width:85%\">";
			page +=  "<tr>";
			uptime = appdata[0].getElementsByTagName("uptime")[0].childNodes[0].nodeValue;
			min = Math.round((uptime/60) - 0.5);
			hours = Math.round((min/60) - 0.5);
			days = Math.round((hours/24) - 0.5);
			sec = uptime % 60;
			min -= (hours * 60);
			hours -= (days * 24);
			page +=  "<td>";
			page +=  "Uptime";
			page +=  "</td>";
			page +=  "<td>";
			page +=  uptime;
			page +=  "</td>";
			page +=  "<td>";
			page +=  days + " days ";
			page +=  hours + " hours ";
			page +=  min + " min ";
			page +=  sec + " sec";
			page +=  "</td></tr>";
			page +=  "<tr>";
			page +=  "<td>";
			page +=  "RTP Payload";
			page +=  "</td>";
			page +=  "<td colspan=2>";
			page +=  appdata[0].getElementsByTagName("rtppayload")[0].childNodes[0].nodeValue;
			page +=  "</td>";
			page +=  "</tr>";
		page +=  "</table><br>";

		frontend = xmlDoc.getElementsByTagName("frontend");
		if (frontend.length > 0) {
			frontenddata = frontend[0].getElementsByTagName("frontenddata");
			if (frontenddata.length > 0) {
				page +=  "<table border='5' style=\"width:85%\">";
				page += "<tr class=\"separator\"><th colspan=\"" + (frontenddata.length+1) + "\">Frontend Info</th></tr>";
				page += addTableLineEntry(frontenddata, "Frontend Index", "frontendindex");
//				page += addTableLineEntry(frontenddata, "Reset", "inputtype");
				page += addTableLineEntry(frontenddata, "Name", "frontendname");
				page += addTableLineEntry(frontenddata, "Path", "pathname");
				page += addTableLineEntry(frontenddata, "Attached", "attached");
				page += addTableLineEntry(frontenddata, "Freq Range", "freq");
				page += addTableLineEntry(frontenddata, "Symbol Rate Range", "symbol");
				page += "<tr class=\"separator\"><th colspan=\"" + (frontenddata.length+1) + "\">Channel Info</th></tr>";
				delsys = addTableLineEntry(frontenddata, "Delivery System", "delsys");
				page += delsys;
				page += addTableLineEntry(frontenddata, "Tune Freq", "tunefreq");
				page += addTableLineEntry(frontenddata, "Modulation", "modulation");
				page += addTableLineEntry(frontenddata, "Fec", "fec");
				page += addTableLineEntry(frontenddata, "Symbol Rate", "tunesymbol");
				page += addTableLineEntry(frontenddata, "Rolloff", "rolloff");
				page += addTableLineEntry(frontenddata, "Source", "src");
				page += addTableLineEntry(frontenddata, "Polarization", "pol");
				page += "<tr class=\"separator\"><th colspan=\"" + (frontenddata.length+1) + "\">Monitor Info</th></tr>";
				page += addTableLineEntry(frontenddata, "Status", "status");
				page += addTableLineEntry(frontenddata, "Signal Strength", "signal");
				page += addTableLineEntry(frontenddata, "snr", "snr");
				page += addTableLineEntry(frontenddata, "ber", "ber");
				page += addTableLineEntry(frontenddata, "unc", "unc");
				
				page +=  "</table><br>";
			}
		}		
		return page;
	}
    function updatePage() {
		loadXMLDoc("frontend.xml");
	}
	// function called when xml is loaded
	function xmlloaded(xml) {
		document.getElementById("content").innerHTML = buildcontent(xml);
	}
</script>

</head>
<body>
<div id="header">
<h3>SAT>IP Frontend Info Page</h3>
</div>

<div id="nav">
<ul class="menu_ul">
  <li class="menu_il"><a href="index.html">Home</a></li>
  <li class="menu_il"><a href="log.html">Log</a></li>
  <li class="menu_il"><a href="frontend.html">Frontend</a></li>
  <li class="menu_il"><a href="config.html">Configure</a></li>
  <li class="menu_il"><a href="#contact">Contact</a></li>
  <li class="menu_il"><a href="#about">About</a></li>
  <li class="menu_il"><a href="STOP">Stop</a></li>
</ul>
</div>

<div id="content" class="log">
<div id="content"></div>
</div>

<script>
    // Call the ajax refresh each refresh_time seconds
    updatePage();
    setInterval("updatePage()", refresh_time);
</script>

<div id="footer">
 Copyright &#169; 2014 Marc Postema
</div>

</body>
</html>
