<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="assets/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="assets/css/stylesheet.css">

<title>SAT>IP - Frontend info Page</title>

<script src="assets/js/menu.js"></script>
<script src="assets/js/loadxmldoc.js"></script>
<script src="assets/js/postxmldoc.js"></script>
<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>
<script src="assets/js/addtableentry.js"></script>
<script>
	var filename = "streams.xml";
	var autoload = 1;
	var xmlLoaded;

	function addTableLineEntry(labelstring, xmlDoc, tagName) {
		var page = "";
		if (xmlDoc.getElementsByTagName(tagName).length != 0) {
			page += "<tr>";
			page += addTableLabel(labelstring);
			var len = xmlDoc.getElementsByTagName("streamindex").length;
			for (en = 0; en < len; en++) {
				var id = "stream" + en;
				var data = xmlDoc.getElementsByTagName(id)[0];
				id += "." + tagName;
				page += addTableEntry(data, tagName, id);
			}
			page += "<tr>";
		}
		return page;
	}

	function buildcontent(xmlDoc) {
		var page = "";
		var streams = xmlDoc.getElementsByTagName("streamindex");
		if (streams.length > 0) {
			page += "<table class=\"table table-bordered table-striped \">";
			page += "<tr class=\"separator\"><th colspan=\"" + (streams.length + 1) + "\">Frontend Info</th></tr>";

			page += addTableLineEntry("Stream Index", xmlDoc, "streamindex");

			page += addTableLineEntry("Enable", xmlDoc, "enable");
			page += addTableLineEntry("Attached", xmlDoc, "attached");
			page += addTableLineEntry("Name", xmlDoc, "frontendname");

			page += addTableLineEntry("Path", xmlDoc, "pathname");
			page += addTableLineEntry("Freq Range", xmlDoc, "freq");
			page += addTableLineEntry("Symbol Rate Range", xmlDoc, "symbol");

			page += "<tr class=\"separator\"><th colspan=\"" + (streams.length+1) + "\">Stream Info</th></tr>";
			page += addTableLineEntry("Owner", xmlDoc, "owner");
			page += addTableLineEntry("Session ID", xmlDoc, "ownerSessionID");
			page += addTableLineEntry("RTP packet count", xmlDoc, "spc");
			page += addTableLineEntry("RTP streamed (MB)", xmlDoc, "payload");

			page += "<tr class=\"separator\"><th colspan=\"" + (streams.length+1) + "\">Stream Configuration</th></tr>";
			page += addTableLineEntry("Repeat DiSEqC", xmlDoc, "diseqc_repeat");
			page += addTableLineEntry("DVR Buffer (Bytes)", xmlDoc, "dvrbuffer");
			page += addTableLineEntry("RTCP Signal Update Freq", xmlDoc, "rtcpSignalUpdate");

			page += "<tr class=\"separator\"><th colspan=\"" + (streams.length+1) + "\">Channel Info</th></tr>";
			delsys = addTableLineEntry("Delivery System", xmlDoc, "delsys");
			page += delsys;
			page += addTableLineEntry("Tune Freq", xmlDoc, "tunefreq");
			page += addTableLineEntry("Modulation", xmlDoc, "modulation");
			page += addTableLineEntry("Fec", xmlDoc, "fec");

			page += addTableLineEntry("Symbol Rate", xmlDoc, "tunesymbol");
			page += addTableLineEntry("Rolloff", xmlDoc, "rolloff");
			page += addTableLineEntry("Source", xmlDoc, "src");
			page += addTableLineEntry("Polarization", xmlDoc, "pol");

			page += "<tr class=\"separator\"><th colspan=\"" + (streams.length+1) + "\">Monitor Info</th></tr>";
			page += addTableLineEntry("Status", xmlDoc, "status");
			page += addTableLineEntry("Signal Strength", xmlDoc, "signal");
			page += addTableLineEntry("snr", xmlDoc, "snr");
			page += addTableLineEntry("ber", xmlDoc, "ber");
			page += addTableLineEntry("unc", xmlDoc, "unc");

			page +=	 "</table><br>";
		}
		return page;
	}
	function updatePage() {
		loadXMLDoc(filename);
	}
	// function called when xml is loaded
	function xmlloaded(xml) {
		if (autoload == 1) {
			xmlLoaded = xml;
			document.getElementById("content").innerHTML = buildcontent(xml);
		}
	}
</script>

</head>
<body>
<div id="menu"></div>
<div id="footer"></div>

<div class="container-fluid">
	<div class="start">
		<h3>SAT>IP Frontend Info Page</h3>
		<div class="table-responsive">
			<div id="content"></div>

			<script>
				// make menu
				document.getElementById("menu").innerHTML = buildmenu();
				document.getElementById("footer").innerHTML = buildfooter();
				setMenuItemActive("frontend");

				// Call the ajax refresh each refresh_time seconds
				var refresh_time = 2000;
				updatePage();
				setInterval("updatePage()", refresh_time);
			</script>
		</div>
	</div>
</div>

</body>
</html>
