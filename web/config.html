<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="stylesheet.css">

<title>SAT>IP Config Page</title>

<script src="menu.js"></script>
<script src="loadxmldoc.js"></script>
<script src="postxmldoc.js"></script>
<script src="jquery.min.js"></script>
<script src="bootstrap.min.js"></script>
<script>
	var filename = "config.xml";
	var autoload = 1;
	var xmlLoaded;

	function validateIPaddress(value) {
		// Regular Expression Pattern
		var ipformat = /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
		if (value.match(ipformat)) {
			return true;
		} else {
			alert("You have entered an invalid IP address!");
			return false;
		}
	}

	function myOnkeyPressPost(id, tagName, value, event) {
		var key = event.which;
		if (key == 13) {
			if (validateIPaddress(value) == true) {
				changeXMLAndPost(id, tagName, value);
			}
		}
	}

	function changeXMLAndPost(id, tagName, value) {
		var input = xmlLoaded.getElementsByTagName(tagName)[0];
		input.getElementsByTagName("value")[0].childNodes[0].nodeValue = value;
		var xmlString = (new XMLSerializer()).serializeToString(xmlLoaded);
		postData(filename, xmlString);
	}

	function addCheckboxInput(labelstring, tagName, input) {
		var id = tagName;
		var entry = "<div class=\"form-group\">";
		entry += "<label for=\"" + id + "\">" + labelstring + "</label>";
		entry += "<input class=\"form-control\" type='checkbox'";
		if (input.getElementsByTagName("value")[0].childNodes[0].nodeValue == "true") {
			entry += "checked=\"true\"";
		}
		entry += "name=\"" + tagName + "\"";
		entry += "id=\"" + id + "\"";
		entry += "onclick=\"changeXMLAndPost(document.getElementById(id).id, document.getElementById(id).name, document.getElementById(id).checked)\"";
		entry += "/>";
		entry += "</div>";
		return entry;
	}

	function addNumberInput(labelstring, tagName, input) {
		var id = tagName;
		var entry = "<div class=\"form-group\">";
		entry += "<label for=\"" + id + "\">" + labelstring + "</label>";
		entry += "<input class=\"form-control\" type=\""+ input.getElementsByTagName("inputtype")[0].childNodes[0].nodeValue + "\"";
		entry += "value=\"" + input.getElementsByTagName("value")[0].childNodes[0].nodeValue + "\"";
		entry += "\" min=\"5\"";
		entry += "name=\"" + tagName + "\"";
		entry += "id=\"" + id + "\"";
		entry += "onfocus=\"autoload = 0\" onblur=\"autoload = 1\"";
		entry += "onclick=\"changeXMLAndPost(document.getElementById(id).id, document.getElementById(id).name, document.getElementById(id).value)\"";
		entry += "onkeypress=\"myOnkeyPressPost(document.getElementById(id).id, document.getElementById(id).name, document.getElementById(id).value, event)\"";
		entry += "/>";
		entry += "</div>";
		return entry;
	}

	function addIPInput(labelstring, tagName, input) {
		var id = tagName;
		var entry = "<div class=\"form-group\">";
		entry += "<label for=\"" + id + "\">" + labelstring + "</label>";
		entry += "<input class=\"form-control\" type='text'";
		entry += "value=\"" + input.getElementsByTagName("value")[0].childNodes[0].nodeValue + "\"";
		entry += "name=\"" + tagName + "\"";
		entry += "id=\"" + id + "\"";
		entry += "onfocus=\"autoload = 0\" onblur=\"autoload = 1\"";
		entry += "onmousedown=\"document.getElementById(id).focus()\"";
		entry += "onclick=\"changeXMLAndPost(document.getElementById(id).id, document.getElementById(id).name, document.getElementById(id).value)\"";
		entry += "onkeypress=\"myOnkeyPressPost(document.getElementById(id).id, document.getElementById(id).name, document.getElementById(id).value, event)\"";
		entry += "/>";
		entry += "</div>";
		return entry;
	}

	function addInput(labelstring, xmlDoc, tagName) {
		var check = xmlDoc.getElementsByTagName(tagName);
		if (check.length != 0) {
			var input = xmlDoc.getElementsByTagName(tagName)[0];
			if (input.getElementsByTagName("inputtype")[0].childNodes[0].nodeValue == "checkbox") {
				return addCheckboxInput(labelstring, tagName, input);
			} else if (input.getElementsByTagName("inputtype")[0].childNodes[0].nodeValue == "ip") {
				return addIPInput(labelstring, tagName, input);
			} else {
				return addNumberInput(labelstring, tagName, input);
			}
		} else {
			return "";
		}
	}

	function buildcontent(xmlDoc) {
		var page = "<div class=\"container\">";
		page += "<form role=\"form\">";
		page += addInput("SSDP Interval (sec):", xmlDoc, "input1");
		page += addInput("OSCam server Enabled:", xmlDoc, "OSCamEnabled");
		page += addInput("OSCam server IP:", xmlDoc, "OSCamIP");
		page += addInput("OSCam server PORT:", xmlDoc, "OSCamPORT");
		page += "</form>";
		page += "</div>";
		return page;
	}
	function updatePage() {
		loadXMLDoc(filename);
	}
	// function called when xml is loaded
	function xmlloaded(xml) {
		if (autoload == 1) {
			xmlLoaded = xml;
			document.getElementById("content").innerHTML = buildcontent(xml);
		}
	}

</script>

</head>
<body>
<div id="menu"></div>

<div class="container-fluid">
	<div class="start">
		<h3>Main Configure Page</h3>
		<div id="content" class="log"></div>
		<script>
			// make menu
			document.getElementById("menu").innerHTML = buildmenu();
			setMenuItemActive("config");

			// Call the ajax refresh each refresh_time seconds
			var refresh_time = 20000;
			updatePage();
			setInterval("updatePage()", refresh_time);
		</script>
	</div>
</div>
<div class="navbar navbar-default navbar-fixed-bottom">
	<div class="container">
		<p class="navbar-text pull-left">Copyright &#169; 2015 Marc Postema</p>
	</div>
</div>
</body>
</html>
